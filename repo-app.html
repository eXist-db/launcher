<!--
`repo-app`
element for displaying package metadata

@demo demo/doc.html
-->

<dom-module id="repo-app">
    <template>
        <style>
            :host {
                display: block;
            }
            ::slotted(repo-title){
                font-size:14px;
            }
        </style>

        <paper-ripple></paper-ripple>
        <slot name="icon"></slot>
        <div id="wrapper" class="wrapper" url="[[url]]">
            <slot></slot>
        </div>
    </template>

    <script>
        class RepoApp extends Polymer.Element {

            static get is() {
                return 'repo-app';
            }

            static get properties() {
                return {
                    type: {
                        type: String,
                        reflectToAttribute: true
                    },
                    path: {
                        type: String,
                        reflectToAttribute: true
                    },
                    status: {
                        type: String,
                        reflectToAttribute: true,
                        notify: true
                    }

                };
            }

            constructor() {
//                console.log('constructor RepoApp')
                super();
            }


            handleInfo (e) {
                e.stopPropagation()
                e.preventDefault()
               var detail = this.querySelector('table');
                if(detail.hasAttribute("class")){
                   detail.removeAttribute("class")
                }else{
                    detail.setAttribute("class","hidden")
                }

            }

            connectedCallback() {
                super.connectedCallback();
                this.addEventListener('click',this._openApp);
                this.addEventListener('keyup',this._handleEnter);
                this.setAttribute('tabindex','0');
            }

            ready () {
                super.ready();

            }

            _handleTap (e) {
//                console.log('handleTap ', e);
                e.stopPropagation();

//                var t = e.composedPath()[0];
//                console.log('_handleTap ', t);
                this._openApp();
            }


            _handleEnter(e) {
                var originalTarget = e.composedPath()[0];

                if (e.target.nodeName.toLowerCase() == "repo-app" && e.keyCode == 13) {
                    this._openApp()
                }
            }

            _openApp(){
                var isApp = this.type == 'application';
                if(isApp && this.status == "installed"){
                    var targetUrl = this.path;
                    setTimeout(function(){
                        window.open(targetUrl);
                    },300);

                }
            }


        }
        window.customElements.define(RepoApp.is, RepoApp);

    </script>
</dom-module>
